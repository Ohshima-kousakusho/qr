<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
    <style>
      input:focus{background:pink; color:blue;}
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.3/html5-qrcode.min.js"></script>
    
  </head>
  <body>
    <div class = "container is-fluid">
      <section class ="hero is-small is-primary">
        <div class ="hero-body">
          <p class = "title">
            大島工作所-電子日報
          </p>
    </div>

      </section>      
    <button class="button is-normal is-fullwidth is-info is-focused" onclick="ChangeName()">ChangeName-名前変更</button>
    <input class ="input is-normal input-name is fullwidth" placeholder="Nameー名前" id ="Name">
    <input class ="input is-normal input-ws is fullwidth" placeholder="Work stationー工程ー機械ー場所">
    <input class ="input is-normal input-code is fullwidth" placeholder="Codeー図面コード" id="fucus-code">
    <input class="input is-warning input-Number is-half is-offset-one-quarter"   placeholder="Number-数量" id="Number-code">
    <input class="input is-danger input-NG is-small is-half is-offset-one-quarter" placeholder="不良数/不足数-Số hàng hỏng hoặc thiếu"  id="NG-code">


    <button class="button is-large is-fullwidth is-primary is-focused" onclick="sendData()">Save-保存</button>
    <div style=" width: 800px; margin: 0 auto;" id="reader"></div>


    <script>
      function ChangeName(){
        document.querySelector('.input-name').value=''
        document.getElementById("Name").focus();

      }
      function sendData(){
        const API_URL = "https://script.google.com/macros/s/AKfycbxYuNTZTlnhaVZlgPEtQSoBs1AVRt_PjoJx0HQ1xANV2EjPOTcKRgGGmvSG71wkvvWx/exec"
        const options = {
          method: 'POST',
          contentType: 'application/json',
          body: JSON.stringify({name: document.querySelector('.input-name').value,ws: document.querySelector('.input-ws').value,Number: document.querySelector('.input-Number').value,NG: document.querySelector('.input-NG').value, class:document.querySelector('.input-code').value})
        }
        const response = fetch(API_URL, options)
        .then(response => response.json())
        .then(data=> console.log(data))
          document.querySelector('.input-code').value=''
          document.querySelector('.input-Number').value=''
          document.querySelector('.input-NG').value=''
          document.getElementById("fucus-code").focus();
        play();
      }

       const API_URL = "https://script.google.com/macros/s/AKfycbxYuNTZTlnhaVZlgPEtQSoBs1AVRt_PjoJx0HQ1xANV2EjPOTcKRgGGmvSG71wkvvWx/exec"
       let html5QrCode;
       const config={fps:5,qrbox: 400}

      function qrCodeSuccessCallback(message) {
        onScanSuccess(message)
      }
      function play() { 

            var audio = new Audio( 
'https://media.geeksforgeeks.org/wp-content/uploads/20190531135120/beep.mp3'); 

            audio.play(); 

        }
           
      function onScanSuccess(qrCodeMessage) {
       html5QrCode.stop()
        const options = {
          method: 'POST',
          contentType: 'application/json',
          body: JSON.stringify({name: document.querySelector('.input-name').value,ws: document.querySelector('.input-ws').value,Number: document.querySelector('.input-Number').value,NG: document.querySelector('.input-NG').value, class:qrCodeMessage})
        }
        const response = fetch(API_URL, options)
        .then(response => response.json())
        .then(data=> startScan())
        document.querySelector('.input-code').value=''
          document.querySelector('.input-Number').value=''
          document.querySelector('.input-NG').value=''
          document.getElementById("fucus-code").focus();
        play();
      }

      function startScan(){
        document.getElementById('reader').innerHTML =''
        html5QrCode = new Html5Qrcode('reader')
        html5QrCode.start ({ facingMode: "environment"},config,qrCodeSuccessCallback)
      }

      startScan(); 
    </script>
  </body>
</html>
